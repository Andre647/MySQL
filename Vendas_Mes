use sucos_vendas; /* database pré estabelecida(exemplo) */


/* CONSULTAS DE VENDAS POR MES, COM O STATUS DE VENDA CONSIDERANDO O VOLUME LIMITE*/
SELECT X.NOME,X.CPF,X.MES_ANO,X.TOTAL,X.MAXIMO,
CASE WHEN(X.TOTAL - X.MAXIMO) > 0 THEN 'INVÁLIDA'
ELSE 'VÁLIDA' END AS STATUS_VENDA
FROM(
SELECT TC.NOME,NF.CPF,date_format(DATA_VENDA, '%Y-%m') AS MES_ANO,sum(INF.QUANTIDADE) AS TOTAL,TC.VOLUME_DE_COMPRA AS MAXIMO
FROM itens_notas_fiscais INF
INNER JOIN notas_fiscais NF
ON NF.NUMERO = INF.NUMERO
INNER JOIN tabela_de_clientes TC
ON TC.CPF = NF.CPF
GROUP BY  TC.NOME,CPF, date_format(DATA_VENDA, '%Y-%m')
ORDER BY NOME) X;
